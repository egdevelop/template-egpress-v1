---
import { getDesignTokens, getCategories } from '../config/siteSettings';

const tokens = getDesignTokens();
const { colors, typography, spacing, borderRadius, shadows } = tokens;
const categories = getCategories();

function hexToRgb(hex: string) {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : { r: 0, g: 0, b: 0 };
}

const categoryVars = categories.map(cat => {
  const rgb = hexToRgb(cat.color);
  return `    --color-category-${cat.id}: ${cat.color};
    --color-category-${cat.id}-light: rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1);`;
}).join('\n');

const categoryStyles = categories.map(cat => `
  .tag-${cat.id} {
    background-color: var(--color-category-${cat.id}-light);
    color: var(--color-category-${cat.id});
  }`).join('\n');

const cssVariables = `
  :root {
    --color-primary: ${colors.primary};
    --color-primary-hover: ${colors.primaryHover};
    --color-primary-light: ${colors.primaryLight};
    --color-secondary: ${colors.secondary};
    --color-accent: ${colors.accent};
    --color-background: ${colors.background};
    --color-surface: ${colors.surface};
    --color-text-primary: ${colors.text.primary};
    --color-text-secondary: ${colors.text.secondary};
    --color-text-muted: ${colors.text.muted};
    --color-text-inverse: ${colors.text.inverse};
    --color-border: ${colors.border};
    --color-success: ${colors.success};
    --color-warning: ${colors.warning};
    --color-error: ${colors.error};
    --font-sans: ${typography.fontFamily.sans};
    --font-serif: ${typography.fontFamily.serif};
    --font-mono: ${typography.fontFamily.mono};
    --shadow-sm: ${shadows.sm};
    --shadow-md: ${shadows.md};
    --shadow-lg: ${shadows.lg};
    --shadow-xl: ${shadows.xl};
    --radius-sm: ${borderRadius.sm};
    --radius-md: ${borderRadius.md};
    --radius-lg: ${borderRadius.lg};
    --radius-xl: ${borderRadius.xl};
    --radius-2xl: ${borderRadius['2xl']};
    --radius-full: ${borderRadius.full};
${categoryVars}
  }
${categoryStyles}
`;
---

<Fragment set:html={`<style>${cssVariables}</style>`} />
