---
interface Props {
  placeholder?: string;
}

const { placeholder = 'Search our blogs by topic or keywords...' } = Astro.props;
---

<div class="relative">
  <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
    <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
  </div>
  <input
    type="text"
    id="search-input"
    class="w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl bg-white text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-rose-500 focus:border-transparent transition-shadow"
    placeholder={placeholder}
  />
</div>

<script>
  import Fuse from 'fuse.js';

  const searchInput = document.getElementById('search-input') as HTMLInputElement;
  const blogCards = document.querySelectorAll('[data-blog-card]');
  
  interface BlogData {
    element: Element;
    title: string;
    description: string;
    category: string;
  }

  const blogData: BlogData[] = Array.from(blogCards).map((card) => ({
    element: card,
    title: card.getAttribute('data-title') || '',
    description: card.getAttribute('data-description') || '',
    category: card.getAttribute('data-category') || '',
  }));

  const fuse = new Fuse(blogData, {
    keys: ['title', 'description', 'category'],
    threshold: 0.4,
    ignoreLocation: true,
  });

  searchInput?.addEventListener('input', (e) => {
    const query = (e.target as HTMLInputElement).value.trim();
    
    if (!query) {
      blogCards.forEach((card) => {
        (card as HTMLElement).style.display = '';
      });
      return;
    }

    const results = fuse.search(query);
    const matchedElements = new Set(results.map((r) => r.item.element));

    blogCards.forEach((card) => {
      if (matchedElements.has(card)) {
        (card as HTMLElement).style.display = '';
      } else {
        (card as HTMLElement).style.display = 'none';
      }
    });
  });
</script>
